{
  "backgroundColor": "#FFFFFF",
  "borderColor": "#E0DEDE",
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": "1",
  "bottomRow": 82,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "defaultModel": "{{NetworkData.getCustomerData()}}",
  "dynamicBindingPathList": [
    {
      "key": "theme"
    },
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "defaultModel"
    }
  ],
  "dynamicHeight": "FIXED",
  "dynamicTriggerPathList": [
    {
      "key": "onResetClick"
    }
  ],
  "events": [
    "onResetClick"
  ],
  "isCanvas": false,
  "isLoading": false,
  "isSearchWildcard": true,
  "isVisible": true,
  "key": "y4iizptz7z",
  "leftColumn": 23,
  "maxDynamicHeight": 9000,
  "minDynamicHeight": 4,
  "mobileBottomRow": 38,
  "mobileLeftColumn": 30,
  "mobileRightColumn": 53,
  "mobileTopRow": 8,
  "needsErrorInfo": false,
  "onResetClick": "{{showAlert('Successfully reset!!', '');}}",
  "originalBottomRow": 59,
  "originalTopRow": 9,
  "parentColumnSpace": 18.460205078125,
  "parentId": "yaeuqx8gh2",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "rightColumn": 64,
  "srcDoc": {
    "css": "/* ============================================================================\n   SECTION 1: Container Reset & Layout\n   ============================================================================ */\n/* Function 1.1: Reset default styles and ensure full viewport */\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\n/* Function 1.2: Root container takes full widget space */\n#root {\n  width: 100%;\n  height: 100%;\n  min-height: 500px; /* Minimum height for usability */\n  position: relative;\n  overflow: hidden;\n}\n\n/* ============================================================================\n   SECTION 2: React Flow Specific Overrides\n   ============================================================================ */\n/* Function 2.1: Ensure React Flow container fills space */\n.react-flow {\n  width: 100% !important;\n  height: 100% !important;\n}\n\n/* Function 2.2: Style minimap for better visibility */\n.react-flow__minimap {\n  background-color: #f9fafb;\n  border: 1px solid #e5e7eb;\n}\n\n/* Function 2.3: Style controls panel */\n.react-flow__controls {\n  background-color: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n/* Function 2.4: Style control buttons */\n.react-flow__controls-button {\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.react-flow__controls-button:hover {\n  background-color: #f3f4f6;\n}\n\n/* ============================================================================\n   SECTION 3: Node & Edge Styling\n   ============================================================================ */\n/* Function 3.1: Node selection highlighting */\n.react-flow__node.selected {\n  box-shadow: 0 0 0 3px #3b82f6;\n}\n\n/* Function 3.2: Edge label styling */\n.react-flow__edge-text {\n  font-size: 11px;\n  font-weight: 600;\n  fill: #374151;\n}\n\n/* Function 3.3: Connection line preview */\n.react-flow__connection-path {\n  stroke: #6366f1;\n  stroke-width: 2;\n}\n\n/* ============================================================================\n   SECTION 4: Handle (Connection Point) Styling\n   ============================================================================ */\n/* Function 4.1: Base handle styling */\n.react-flow__handle {\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  border: 2px solid #3b82f6;\n  background-color: white;\n}\n\n/* Function 4.2: Handle hover state */\n.react-flow__handle:hover {\n  background-color: #3b82f6;\n  transform: scale(1.2);\n}\n\n/* Function 4.3: Handle connection state */\n.react-flow__handle-connecting {\n  background-color: #10b981;\n}\n\n/* Function 4.4: Valid connection target */\n.react-flow__handle-valid {\n  background-color: #10b981;\n}\n\n/* ============================================================================\n   SECTION 5: Background & Grid\n   ============================================================================ */\n/* Function 5.1: Background pattern styling */\n.react-flow__background {\n  background-color: #ffffff;\n}\n\n/* Function 5.2: Grid dot styling */\n.react-flow__background-pattern {\n  fill: #e5e7eb;\n}\n\n/* ============================================================================\n   SECTION 6: Loading & Error States\n   ============================================================================ */\n/* Function 6.1: Loading indicator */\n.topology-loading {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", sans-serif;\n  color: #6b7280;\n}\n\n/* Function 6.2: Error message styling */\n.topology-error {\n  padding: 20px;\n  color: #ef4444;\n  font-family: monospace;\n  background-color: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  margin: 20px;\n}",
    "html": "<!-- ============================================================================\n     REACT FLOW NETWORK TOPOLOGY - HTML COMPONENT\n     ============================================================================\n     \n     This is the HTML section of the Appsmith Custom Widget.\n     Copy this content into the \"HTML\" tab of your Custom Widget Builder.\n     \n     Components:\n     1. Root container for React rendering\n     2. Import map for ESM module resolution\n     3. React Flow CSS stylesheet\n     \n     ============================================================================\n-->\n\n<!-- FUNCTION 1: Root Container -->\n<div id=\"root\" style=\"width: 100%; height: 100%; min-height: 500px;\">\n  <p style=\"padding: 20px;\">Loading React Flow...</p>\n</div>\n\n<!-- FUNCTION 2: Import Map for ESM -->\n<script type=\"importmap\">\n{\n  \"imports\": {\n    \"react\": \"https://esm.sh/react@18.3.1\",\n    \"react-dom/client\": \"https://esm.sh/react-dom@18.3.1/client\",\n    \"reactflow\": \"https://esm.sh/reactflow@11.11.4\"\n  }\n}\n</script>\n\n<!-- FUNCTION 3: React Flow CSS -->\n<link \n  href=\"https://cdn.jsdelivr.net/npm/reactflow@11.11.4/dist/style.min.css\" \n  rel=\"stylesheet\"\n/>\n",
    "js": "/* ============================================================================\n * REACT FLOW NETWORK TOPOLOGY - DATA-DRIVEN VISUALIZATION\n * ============================================================================\n * \n * Project: Network Topology Migration from Mermaid to React Flow\n * Created: November 2025\n * \n * Purpose: Interactive network topology visualization with PostgreSQL integration\n * \n * Data Sources:\n * - appsmith.store.statclickaccount (selected customer)\n * - manipTable.tableData (customer configurations from PostgreSQL)\n * \n * Key Features:\n * - Dynamic node generation based on customer data\n * - Support for Gen1 (SBC) and IVP configurations\n * - Backbone trunk visualization\n * - Carrier connections with session agent details\n * - IVP service routing with inbound URIs\n * \n * ============================================================================\n */\n\n/* FUNCTION 1: Import Libraries and Initialize */\nappsmith.onReady(async () => {\n  console.log('=== ReactFlow Network Topology Init ===');\n  try {\n    const React = await import('https://esm.sh/react');\n    const ReactDOMClient = await import('https://esm.sh/react-dom/client');\n    const ReactFlowModule = await import('https://esm.sh/reactflow');\n    const {\n      default: ReactFlow,\n      Controls,\n      Background,\n      MiniMap,\n      Handle,\n      Position\n    } = ReactFlowModule;\n\n    /* ========================================================================\n     * CUSTOM NODE COMPONENTS\n     * ========================================================================\n     */\n\n    /* FUNCTION 2: Custom SBC Node with Multiple Handles */\n    const SBCNode = ({\n      data\n    }) => {\n      return React.createElement('div', {\n        style: data.style\n      }, [\n      // Left handle for carrier input\n      React.createElement(Handle, {\n        key: 'target-left',\n        type: 'target',\n        position: Position.Left,\n        id: 'left',\n        style: {\n          background: '#555'\n        }\n      }),\n      // Right handle for customer/IVP output\n      React.createElement(Handle, {\n        key: 'source-right',\n        type: 'source',\n        position: Position.Right,\n        id: 'right',\n        style: {\n          background: '#555'\n        }\n      }),\n      // Sema handles (if needed)\n      React.createElement(Handle, {\n        key: 'source-bottom-dirty',\n        type: 'source',\n        position: Position.Bottom,\n        id: 'bottom-dirty',\n        style: {\n          left: '40%',\n          background: '#d32f2f'\n        }\n      }), React.createElement(Handle, {\n        key: 'source-bottom-clean',\n        type: 'source',\n        position: Position.Bottom,\n        id: 'bottom-clean',\n        style: {\n          left: '60%',\n          background: '#388e3c'\n        }\n      }), React.createElement(Handle, {\n        key: 'target-top-dirty',\n        type: 'target',\n        position: Position.Top,\n        id: 'top-dirty',\n        style: {\n          left: '40%',\n          background: '#d32f2f'\n        }\n      }), React.createElement(Handle, {\n        key: 'target-top-clean',\n        type: 'target',\n        position: Position.Top,\n        id: 'top-clean',\n        style: {\n          left: '60%',\n          background: '#388e3c'\n        }\n      }),\n      // Label with line breaks\n      React.createElement('div', {\n        key: 'label',\n        style: {\n          whiteSpace: 'pre-line',\n          textAlign: 'center'\n        },\n        dangerouslySetInnerHTML: {\n          __html: data.label\n        }\n      })]);\n    };\n\n    /* FUNCTION 3: Custom Sema Node */\n    const SemaNode = ({\n      data\n    }) => {\n      return React.createElement('div', {\n        style: data.style\n      }, [React.createElement(Handle, {\n        key: 'target-top-dirty',\n        type: 'target',\n        position: Position.Top,\n        id: 'top-dirty',\n        style: {\n          left: '40%',\n          background: '#d32f2f'\n        }\n      }), React.createElement(Handle, {\n        key: 'target-top-clean',\n        type: 'target',\n        position: Position.Top,\n        id: 'top-clean',\n        style: {\n          left: '60%',\n          background: '#388e3c'\n        }\n      }), React.createElement(Handle, {\n        key: 'source-bottom-dirty',\n        type: 'source',\n        position: Position.Bottom,\n        id: 'bottom-dirty',\n        style: {\n          left: '40%',\n          background: '#d32f2f'\n        }\n      }), React.createElement(Handle, {\n        key: 'source-bottom-clean',\n        type: 'source',\n        position: Position.Bottom,\n        id: 'bottom-clean',\n        style: {\n          left: '60%',\n          background: '#388e3c'\n        }\n      }), React.createElement('div', {\n        key: 'label'\n      }, data.label)]);\n    };\n\n    /* FUNCTION 4: Custom IVP Cloud Node */\n    const IVPNode = ({\n      data\n    }) => {\n      return React.createElement('div', {\n        style: data.style\n      }, [React.createElement(Handle, {\n        key: 'target-left',\n        type: 'target',\n        position: Position.Left,\n        id: 'left',\n        style: {\n          background: '#555'\n        }\n      }), React.createElement(Handle, {\n        key: 'source-right',\n        type: 'source',\n        position: Position.Right,\n        id: 'right',\n        style: {\n          background: '#555'\n        }\n      }), React.createElement('div', {\n        key: 'label',\n        style: {\n          whiteSpace: 'pre-line',\n          textAlign: 'center'\n        }\n      }, '‚òÅÔ∏è ' + data.label)]);\n    };\n\n    /* FUNCTION 4.5: Custom Carrier Node with Top and Right Handles */\n    const CarrierNode = ({\n      data\n    }) => {\n      return React.createElement('div', {\n        style: data.style\n      }, [\n      // Top handle for IVP connections\n      React.createElement(Handle, {\n        key: 'source-top',\n        type: 'source',\n        position: Position.Top,\n        id: 'top',\n        style: {\n          background: '#555'\n        }\n      }),\n      // Right handle for SBC connections\n      React.createElement(Handle, {\n        key: 'source-right',\n        type: 'source',\n        position: Position.Right,\n        id: 'right',\n        style: {\n          background: '#555'\n        }\n      }), React.createElement('div', {\n        key: 'label',\n        style: {\n          textAlign: 'center'\n        }\n      }, data.label)]);\n    };\n\n    /* FUNCTION 5: Node Types Registry */\n    const nodeTypes = {\n      sbcNode: SBCNode,\n      semaNode: SemaNode,\n      ivpNode: IVPNode,\n      carrierNode: CarrierNode\n    };\n\n    /* ========================================================================\n     * DATA PROCESSING UTILITIES\n     * ========================================================================\n     */\n\n    /* FUNCTION 6: Parse JSON Fields */\n    const parseJsonField = field => {\n      if (!field || field === 'null' || field === '[]') return [];\n      try {\n        return JSON.parse(field);\n      } catch {\n        return [];\n      }\n    };\n\n    /* FUNCTION 7: Split Concatenated Fields */\n    const splitConcatenatedField = field => {\n      if (!field || field === 'null' || field === 'N/A') return [];\n      return field.split(', ').map(s => s.trim());\n    };\n\n    /* FUNCTION 8: Build Session Agent Info */\n    const buildSessionAgentInfo = data => {\n      if (!data) return \"N/A\";\n      const realm = data.source_realm || \"N/A\";\n      const sessionAgentsRaw = data.customer_realm_session_agents || \"N/A\";\n      const sessionAgents = sessionAgentsRaw === \"N/A\" ? \"N/A\" : sessionAgentsRaw.split(',').map(s => s.trim()).join('\\n');\n      const sipIpsRaw = data.sip_interface_ips || \"N/A\";\n      const sipIps = sipIpsRaw === \"N/A\" ? \"N/A\" : sipIpsRaw.split(',').map(s => s.trim()).join('\\n');\n      return `Realm: ${realm}\\nAgents:\\n${sessionAgents}\\nSIP IPs:\\n${sipIps}`;\n    };\n\n    /* ========================================================================\n     * MAIN NETWORK BUILDER FUNCTION\n     * ========================================================================\n     */\n\n    /* FUNCTION 9: Build Network Topology */\n    const buildNetworkTopology = () => {\n      // Get data from widget model (passed via JSObject)\n      // Data is already filtered to selected customer and is a real array\n      const selectedAccountNo = appsmith.model?.selectedAccount;\n      const tableData = appsmith.model?.customerData || [];\n      console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n      console.log('üîç DIAGNOSTIC: buildNetworkTopology called');\n      console.log('üìä Selected account:', selectedAccountNo);\n      console.log('üìä Customer data rows:', tableData.length);\n      if (tableData.length > 0) {\n        console.log('üìä Data sources:', tableData.map(r => r.data_source).join(', '));\n      }\n      console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n\n      // Default state - no selection\n      if (!selectedAccountNo) {\n        return {\n          nodes: [{\n            id: 'msg',\n            type: 'default',\n            data: {\n              label: 'Select a customer\\nto view network diagram'\n            },\n            position: {\n              x: 400,\n              y: 200\n            },\n            style: {\n              background: '#f0f0f0',\n              border: '2px solid #999',\n              borderRadius: '8px',\n              padding: '20px',\n              fontSize: '14px',\n              textAlign: 'center'\n            }\n          }],\n          edges: []\n        };\n      }\n\n      // Find customer data\n      const customer = tableData.find(c => c.account_no === selectedAccountNo);\n\n      // ============================================================================\n      // DIAGNOSTIC LOGGING - Customer Match\n      // ============================================================================\n      console.log('üîç DIAGNOSTIC: Customer lookup');\n      console.log('üìä Looking for account_no:', selectedAccountNo);\n      console.log('üìä Found customer?', customer ? 'YES ‚úÖ' : 'NO ‚ùå');\n      if (customer) {\n        console.log('üìä Customer name:', customer.customer);\n        console.log('üìä Customer account_no:', customer.account_no);\n      } else if (tableData.length > 0) {\n        // Try to find why match failed\n        const possibleMatches = tableData.filter(c => {\n          return String(c.account_no).includes(String(selectedAccountNo));\n        });\n        console.log('üìä Possible partial matches:', possibleMatches.length);\n        if (possibleMatches.length > 0) {\n          console.log('üìä Partial match examples:', possibleMatches.slice(0, 3).map(c => ({\n            account_no: c.account_no,\n            type: typeof c.account_no\n          })));\n        }\n      }\n      console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n      // ============================================================================\n\n      if (!customer) {\n        return {\n          nodes: [{\n            id: 'msg',\n            type: 'default',\n            data: {\n              label: `Account ${selectedAccountNo}\\n\\nNo Gen1 or IVP\\nconnections found`\n            },\n            position: {\n              x: 400,\n              y: 200\n            },\n            style: {\n              background: '#fff3cd',\n              border: '2px solid #ffc107',\n              borderRadius: '8px',\n              padding: '20px',\n              fontSize: '14px',\n              textAlign: 'center'\n            }\n          }],\n          edges: []\n        };\n      }\n\n      // Extract customer metadata\n      const carriers = customer.carrier_connections || \"Carrier\";\n      const usesSema = customer.uses_sema_payments === true;\n      const hasBackbone = customer.gen1_ivp_backbone === true;\n      const customerName = customer.customer;\n      const accountNo = customer.account_no;\n\n      // Check for Gen1 configuration\n      const sourceRealm = customer.source_realm || \"\";\n      const hasGen1Realm = sourceRealm !== \"\" && sourceRealm !== null && sourceRealm !== \"null\";\n      const hasLocalPolicyData = customer.local_policy_summary && customer.local_policy_summary !== 'null' && customer.local_policy_summary.trim() !== '';\n      const hasGen1DataSource = customer.data_source && (customer.data_source.startsWith('SYD1') || customer.data_source.startsWith('SYD2'));\n      const showGen1Customer = hasGen1Realm || hasLocalPolicyData || hasGen1DataSource;\n\n      // Find SYD1/SYD2 specific data\n      const allCustomerRows = tableData.filter(c => c.account_no === selectedAccountNo);\n      const syd1Data = allCustomerRows.find(c => c.data_source && c.data_source.startsWith('SYD1'));\n      const syd2Data = allCustomerRows.find(c => c.data_source && c.data_source.startsWith('SYD2'));\n\n      // Build session agent info\n      const sessagen1 = buildSessionAgentInfo(syd1Data);\n      const sessagen2 = buildSessionAgentInfo(syd2Data);\n\n      // Get first IVP data row (avoid duplicates)\n      const firstIvpRow = allCustomerRows.find(row => {\n        const sipSvcs = parseJsonField(row.ivp_svcSIP);\n        const voiceGws = parseJsonField(row.ivp_svcVoiceGateway);\n        return sipSvcs.length > 0 || voiceGws.length > 0;\n      });\n\n      // Build IVP service table\n      const buildIvpServiceTable = data => {\n        if (!data) return {\n          serviceTable: [],\n          carriages: []\n        };\n        const sipSvcs = parseJsonField(data.ivp_svcSIP);\n        const voiceGws = parseJsonField(data.ivp_svcVoiceGateway);\n        const carriages = parseJsonField(data.ivp_svccarriages);\n        const regionNames = splitConcatenatedField(data[\"Region Name\"]);\n        const ivpNames = splitConcatenatedField(data.IVPName);\n        const routingDomains = splitConcatenatedField(data[\"Routing Domain\"]);\n        const inboundUris = splitConcatenatedField(data[\"Inbound server/uri\"]);\n        const serviceTable = [];\n\n        // Process SIP services\n        sipSvcs.forEach((svc, idx) => {\n          serviceTable.push({\n            type: 'SIP',\n            regionName: regionNames[idx] || 'AU1',\n            ivpName: ivpNames[idx] || 'N/A',\n            routingDomain: routingDomains[idx] || 'N/A',\n            inboundUri: inboundUris[idx] || 'N/A',\n            serviceData: svc,\n            index: idx\n          });\n        });\n\n        // Process Voice Gateway services\n        voiceGws.forEach((gw, idx) => {\n          const serviceIdx = sipSvcs.length + idx;\n          serviceTable.push({\n            type: 'VoiceGateway',\n            regionName: regionNames[serviceIdx] || 'AU1',\n            ivpName: ivpNames[serviceIdx] || 'N/A',\n            routingDomain: routingDomains[serviceIdx] || 'N/A',\n            inboundUri: inboundUris[serviceIdx] || 'N/A',\n            serviceData: gw,\n            index: serviceIdx\n          });\n        });\n        return {\n          serviceTable,\n          carriages\n        };\n      };\n      const ivpData = buildIvpServiceTable(firstIvpRow);\n      const hasAnyIvpServices = ivpData.serviceTable.length > 0;\n      const hasIvpCarriages = ivpData.carriages.length > 0;\n\n      // Validate customer has connections\n      if (!hasGen1Realm && !hasAnyIvpServices) {\n        return {\n          nodes: [{\n            id: 'msg',\n            type: 'default',\n            data: {\n              label: `${customerName}\\n(${accountNo})\\n\\nNo Gen1 or IVP\\nconnections found`\n            },\n            position: {\n              x: 400,\n              y: 200\n            },\n            style: {\n              background: '#fff3cd',\n              border: '2px solid #ffc107',\n              borderRadius: '8px',\n              padding: '20px',\n              fontSize: '14px',\n              textAlign: 'center'\n            }\n          }],\n          edges: []\n        };\n      }\n\n      /* ====================================================================\n       * BUILD NODES AND EDGES\n       * ====================================================================\n       */\n\n      const nodes = [];\n      const edges = [];\n\n      // ============================================================================\n      // LAYOUT CONFIGURATION - Clean Column-Based Positioning\n      // ============================================================================\n      const LAYOUT = {\n        COLUMN_1_CARRIERS: 100,\n        // Left edge - carriers\n        COLUMN_2_SBC: 500,\n        // SBC datacenter  \n        COLUMN_3_IVP: 950,\n        // IVP cloud\n        COLUMN_4_SERVICES: 1400,\n        // Customer services\n        VERTICAL_SPACING: 280,\n        // Space between stacked nodes\n        TOP_MARGIN: -100 // Moved up by 180px (was 80, now -100)\n      };\n\n      // Determine layout parameters\n      const ivpRegions = new Set();\n      ivpData.serviceTable.forEach(svc => ivpRegions.add(svc.regionName));\n      const hasIvpAU1 = ivpRegions.has('AU1');\n      const hasIvpAU2 = ivpRegions.has('AU2');\n\n      /* FUNCTION 10: Add Carrier Node */\n      nodes.push({\n        id: 'carrier',\n        type: 'carrierNode',\n        // Changed from 'input' to 'carrierNode'\n        data: {\n          label: carriers\n        },\n        position: {\n          x: LAYOUT.COLUMN_1_CARRIERS,\n          y: hasIvpAU1 && hasIvpAU2 ? LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING : LAYOUT.TOP_MARGIN + 100\n        },\n        style: {\n          background: '#E3F2FD',\n          border: '2px solid #2196F3',\n          borderRadius: '8px',\n          padding: '15px 25px',\n          fontSize: '16px',\n          fontWeight: '600',\n          minWidth: '180px',\n          textAlign: 'center'\n        }\n      });\n\n      /* FUNCTION 11: Add IVP Nodes and Services */\n      if (hasAnyIvpServices) {\n        // Add IVP AU1 - MOVED UP 100px\n        if (hasIvpAU1) {\n          nodes.push({\n            id: 'IVP-AU1',\n            type: 'ivpNode',\n            data: {\n              label: 'IVP - AU1'\n            },\n            position: {\n              x: LAYOUT.COLUMN_3_IVP,\n              y: LAYOUT.TOP_MARGIN - 100\n            },\n            // -100px\n            sourcePosition: Position.Right,\n            targetPosition: Position.Left,\n            style: {\n              background: 'linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%)',\n              border: '3px solid #4CAF50',\n              borderRadius: '12px',\n              padding: '18px 28px',\n              fontSize: '15px',\n              fontWeight: '600',\n              minWidth: '200px',\n              textAlign: 'center'\n            }\n          });\n        }\n\n        // Add IVP AU2 - MOVED UP 100px\n        if (hasIvpAU2) {\n          nodes.push({\n            id: 'IVP-AU2',\n            type: 'ivpNode',\n            data: {\n              label: 'IVP - AU2'\n            },\n            position: {\n              x: LAYOUT.COLUMN_3_IVP,\n              y: LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING - 200\n            },\n            // -100px\n            sourcePosition: Position.Right,\n            targetPosition: Position.Left,\n            style: {\n              background: 'linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%)',\n              border: '3px solid #4CAF50',\n              borderRadius: '12px',\n              padding: '18px 28px',\n              fontSize: '15px',\n              fontWeight: '600',\n              minWidth: '200px',\n              textAlign: 'center'\n            }\n          });\n        }\n\n        // Add IVP Service Boxes\n        const instanceCounters = {};\n        ivpRegions.forEach(region => {\n          instanceCounters[region] = 0;\n        });\n        let au1ServiceY = LAYOUT.TOP_MARGIN - 250; // -100px to match IVP-AU1\n        let au2ServiceY = LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING - 100; // -100px to match IVP-AU2\n\n        ivpData.serviceTable.forEach(svc => {\n          // ... rest of the service creation code remains the same\n          const region = svc.regionName;\n          instanceCounters[region]++;\n          const seqNum = instanceCounters[region];\n          const serviceNodeId = `service_inbound_${region}_${seqNum}`;\n\n          // Calculate Y position based on region\n          let serviceY;\n          if (region === 'AU1') {\n            serviceY = au1ServiceY;\n            au1ServiceY += 120; // Stack multiple AU1 services vertically\n          } else {\n            serviceY = au2ServiceY;\n            au2ServiceY += 120; // Stack multiple AU2 services vertically\n          }\n\n          // Create service label\n          const serviceLabel = svc.type === 'SIP' ? `${svc.ivpName}\\n${svc.serviceData.profile?.name || 'SIP Service'}\\nInbound: ${svc.inboundUri}` : `${svc.ivpName}\\nInbound: ${svc.inboundUri}`;\n\n          // Add service node\n          nodes.push({\n            id: serviceNodeId,\n            type: 'output',\n            data: {\n              label: serviceLabel\n            },\n            position: {\n              x: LAYOUT.COLUMN_4_SERVICES,\n              y: serviceY\n            },\n            targetPosition: Position.Left,\n            style: {\n              background: 'linear-gradient(135deg, #E1F5FE 0%, #B3E5FC 100%)',\n              border: '3px solid #0277BD',\n              borderRadius: '12px',\n              padding: '15px 20px',\n              fontSize: '13px',\n              whiteSpace: 'pre-line',\n              textAlign: 'center',\n              minWidth: '280px',\n              fontWeight: '500'\n            }\n          });\n\n          // Add edge from IVP to service\n          edges.push({\n            id: `e-ivp-${region}-${seqNum}`,\n            source: `IVP-${region}`,\n            target: serviceNodeId,\n            label: svc.routingDomain,\n            type: 'smoothstep',\n            // Smooth routing for cleaner look\n            style: {\n              stroke: '#7b1fa2',\n              strokeWidth: 2.5\n            },\n            labelStyle: {\n              fontSize: '11px',\n              fill: '#666',\n              fontWeight: '500'\n            }\n          });\n        });\n\n        // Add carrier to IVP connection if carriages exist\n        if (hasIvpCarriages) {\n          const carriageLabel = ivpData.carriages.map(c => c.name).join(', ');\n          const targetIvp = hasIvpAU1 ? 'IVP-AU1' : 'IVP-AU2';\n          edges.push({\n            id: 'e-carrier-ivp',\n            source: 'carrier',\n            sourceHandle: 'top',\n            // ADDED: Use top handle\n            target: targetIvp,\n            label: carriageLabel,\n            type: 'smoothstep',\n            animated: true,\n            style: {\n              stroke: '#1976d2',\n              strokeWidth: 2.5\n            },\n            labelStyle: {\n              fontSize: '11px',\n              fill: '#666',\n              fontWeight: '500'\n            }\n          });\n        }\n      }\n\n      /* FUNCTION 12: Add Gen1 SBC Nodes */\n      if (showGen1Customer) {\n        // Add SYD1 - MOVED DOWN 200px\n        nodes.push({\n          id: 'SYD1',\n          type: 'sbcNode',\n          data: {\n            label: `SYD1 Data-Centre SBC\\n${sessagen1}`,\n            style: {\n              background: 'linear-gradient(135deg, #BBDEFB 0%, #E3F2FD 100%)',\n              border: '3px solid #1565C0',\n              borderRadius: '12px',\n              padding: '20px',\n              fontSize: '13px',\n              width: '320px',\n              fontWeight: '500'\n            }\n          },\n          position: {\n            x: LAYOUT.COLUMN_2_SBC,\n            y: LAYOUT.TOP_MARGIN + 200\n          },\n          // +200px\n          sourcePosition: Position.Right,\n          targetPosition: Position.Left\n        });\n\n        // Add Sema if needed - MOVED DOWN 200px\n        if (usesSema) {\n          nodes.push({\n            id: 'Sema',\n            type: 'semaNode',\n            data: {\n              label: 'Sema',\n              style: {\n                background: '#FFE0B2',\n                border: '3px solid #F57C00',\n                borderRadius: '10px',\n                padding: '18px 30px',\n                fontSize: '16px',\n                fontWeight: 'bold',\n                textAlign: 'center',\n                minWidth: '120px'\n              }\n            },\n            position: {\n              x: LAYOUT.COLUMN_2_SBC + 100,\n              y: LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING * 0.8 + 200\n            } // +200px\n          });\n\n          // Sema connections (unchanged)\n          edges.push({\n            id: 'e-syd1-sema-dirty',\n            source: 'SYD1',\n            sourceHandle: 'bottom-dirty',\n            target: 'Sema',\n            targetHandle: 'top-dirty',\n            label: 'dirty',\n            type: 'straight',\n            style: {\n              stroke: '#d32f2f',\n              strokeWidth: 2\n            },\n            labelStyle: {\n              fill: '#d32f2f',\n              fontWeight: 600,\n              fontSize: '10px'\n            }\n          }, {\n            id: 'e-syd1-sema-clean',\n            source: 'SYD1',\n            sourceHandle: 'bottom-clean',\n            target: 'Sema',\n            targetHandle: 'top-clean',\n            label: 'clean',\n            type: 'straight',\n            style: {\n              stroke: '#388e3c',\n              strokeWidth: 2\n            },\n            labelStyle: {\n              fill: '#388e3c',\n              fontWeight: 600,\n              fontSize: '10px'\n            }\n          });\n        }\n\n        // Add SYD2 - MOVED DOWN 200px\n        nodes.push({\n          id: 'SYD2',\n          type: 'sbcNode',\n          data: {\n            label: `SYD2 Data-Centre SBC\\n${sessagen2}`,\n            style: {\n              background: 'linear-gradient(135deg, #BBDEFB 0%, #E3F2FD 100%)',\n              border: '3px solid #1565C0',\n              borderRadius: '12px',\n              padding: '20px',\n              fontSize: '13px',\n              width: '320px',\n              fontWeight: '500'\n            }\n          },\n          position: {\n            x: LAYOUT.COLUMN_2_SBC,\n            y: LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING * 1.5 + 200\n          },\n          // +200px\n          sourcePosition: Position.Right,\n          targetPosition: Position.Left\n        });\n\n        // Sema to SYD2 connections\n        if (usesSema) {\n          edges.push({\n            id: 'e-sema-syd2-dirty',\n            source: 'Sema',\n            sourceHandle: 'bottom-dirty',\n            target: 'SYD2',\n            targetHandle: 'top-dirty',\n            label: 'dirty',\n            type: 'straight',\n            style: {\n              stroke: '#d32f2f',\n              strokeWidth: 2\n            },\n            labelStyle: {\n              fill: '#d32f2f',\n              fontWeight: 600,\n              fontSize: '10px'\n            }\n          }, {\n            id: 'e-sema-syd2-clean',\n            source: 'Sema',\n            sourceHandle: 'bottom-clean',\n            target: 'SYD2',\n            targetHandle: 'top-clean',\n            label: 'clean',\n            type: 'straight',\n            style: {\n              stroke: '#388e3c',\n              strokeWidth: 2\n            },\n            labelStyle: {\n              fill: '#388e3c',\n              fontWeight: 600,\n              fontSize: '10px'\n            }\n          });\n        }\n\n        // Carrier to SBC connections\n        // Carrier to SBC connections\n        edges.push({\n          id: 'e-carrier-syd1',\n          source: 'carrier',\n          sourceHandle: 'right',\n          // ADDED: Use right handle\n          target: 'SYD1',\n          targetHandle: 'left',\n          type: 'smoothstep',\n          animated: true,\n          style: {\n            stroke: '#1976d2',\n            strokeWidth: 2.5\n          }\n        }, {\n          id: 'e-carrier-syd2',\n          source: 'carrier',\n          sourceHandle: 'right',\n          // ADDED: Use right handle\n          target: 'SYD2',\n          targetHandle: 'left',\n          type: 'smoothstep',\n          style: {\n            stroke: '#1976d2',\n            strokeWidth: 1.5,\n            strokeDasharray: '5,5'\n          }\n        });\n\n        // Gen1 Customer Node - show when customer has Gen1 realm configuration\n        if (hasGen1Realm) {\n          const gen1Y = hasIvpAU1 && hasIvpAU2 ? LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING * 1.2 + 400 // ADDED +400px\n          : LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING * 0.5 + 400; // ADDED +400px\n\n          nodes.push({\n            id: 'Gen1Cust',\n            type: 'output',\n            data: {\n              label: `${customerName} Services\\n(${accountNo})\\nRealm: ${sourceRealm}`\n            },\n            position: {\n              x: LAYOUT.COLUMN_4_SERVICES,\n              y: gen1Y\n            },\n            targetPosition: Position.Left,\n            style: {\n              background: 'linear-gradient(135deg, #FFF9C4 0%, #FFF59D 100%)',\n              border: '3px solid #F9A825',\n              borderRadius: '12px',\n              padding: '15px 20px',\n              fontSize: '13px',\n              whiteSpace: 'pre-line',\n              textAlign: 'center',\n              minWidth: '250px',\n              fontWeight: '500'\n            }\n          });\n\n          // SBC to Gen1 Customer connections\n          const syd1Realm = syd1Data?.source_realm;\n          const syd2Realm = syd2Data?.source_realm;\n          if (syd1Realm && syd1Realm !== 'N/A') {\n            edges.push({\n              id: 'e-syd1-gen1',\n              source: 'SYD1',\n              sourceHandle: 'right',\n              target: 'Gen1Cust',\n              label: syd1Realm,\n              type: 'smoothstep',\n              style: {\n                stroke: '#388e3c',\n                strokeWidth: 2.5\n              },\n              labelStyle: {\n                fontSize: '11px',\n                fill: '#666',\n                fontWeight: '500'\n              }\n            });\n          }\n          if (syd2Realm && syd2Realm !== 'N/A' && syd2Realm !== null) {\n            edges.push({\n              id: 'e-syd2-gen1',\n              source: 'SYD2',\n              sourceHandle: 'right',\n              target: 'Gen1Cust',\n              label: syd2Realm,\n              type: 'smoothstep',\n              style: {\n                stroke: '#388e3c',\n                strokeWidth: 1.5,\n                strokeDasharray: '5,5'\n              },\n              labelStyle: {\n                fontSize: '11px',\n                fill: '#666'\n              }\n            });\n          }\n        }\n\n        // BACKBONE TRUNK: Direct SBC to IVP connection (thick green line)\n        if (hasBackbone && hasAnyIvpServices) {\n          const targetIvp = hasIvpAU1 ? 'IVP-AU1' : 'IVP-AU2';\n          edges.push({\n            id: 'e-backbone-trunk',\n            source: 'SYD1',\n            sourceHandle: 'right',\n            target: targetIvp,\n            targetHandle: 'left',\n            label: 'Backbone',\n            type: 'smoothstep',\n            // Use smooth routing to avoid crossing Sema\n            animated: true,\n            style: {\n              stroke: '#4CAF50',\n              strokeWidth: 5\n            },\n            labelStyle: {\n              fontSize: '13px',\n              fill: '#2E7D32',\n              fontWeight: 'bold',\n              background: 'white',\n              padding: '2px 6px',\n              borderRadius: '4px'\n            }\n          });\n        }\n      }\n      return {\n        nodes,\n        edges\n      };\n    };\n\n    /* ========================================================================\n     * REACT FLOW COMPONENT\n     * ========================================================================\n     */\n\n    /* FUNCTION 13: Network Flow Component */\n    const NetworkFlow = () => {\n      const [nodes, setNodes] = React.useState([]);\n      const [edges, setEdges] = React.useState([]);\n      const [lastAccount, setLastAccount] = React.useState(null);\n\n      // Poll for changes to customer selection\n      React.useEffect(() => {\n        // Initial load\n        const updateTopology = () => {\n          const currentAccount = appsmith.model?.selectedAccount;\n\n          // Only rebuild if account changed\n          if (currentAccount !== lastAccount) {\n            console.log('üîÑ Customer selection changed:', lastAccount, '‚Üí', currentAccount);\n            setLastAccount(currentAccount);\n            const newTopology = buildNetworkTopology();\n            setNodes(newTopology.nodes);\n            setEdges(newTopology.edges);\n          }\n        };\n\n        // Initial render\n        updateTopology();\n\n        // Poll every 500ms for changes\n        const interval = setInterval(updateTopology, 500);\n        return () => clearInterval(interval);\n      }, [lastAccount]);\n      return React.createElement('div', {\n        style: {\n          width: '100%',\n          height: '700px'\n        }\n      }, React.createElement(ReactFlow, {\n        nodes,\n        edges,\n        nodeTypes,\n        fitView: true,\n        minZoom: 0.3,\n        maxZoom: 1.5,\n        defaultViewport: {\n          x: 0,\n          y: 0,\n          zoom: 0.7\n        }\n      }, [React.createElement(Controls, {\n        key: 'controls'\n      }), React.createElement(MiniMap, {\n        key: 'minimap',\n        nodeColor: node => {\n          if (node.type === 'group') return 'rgba(200, 200, 200, 0.3)';\n          if (node.style?.background) return node.style.background;\n          return '#ddd';\n        },\n        maskColor: 'rgba(0, 0, 0, 0.1)'\n      }), React.createElement(Background, {\n        key: 'background',\n        variant: 'dots',\n        gap: 16,\n        size: 1,\n        color: '#ddd'\n      })]));\n    };\n\n    /* FUNCTION 14: Render to DOM */\n    const container = document.getElementById('root');\n    const root = ReactDOMClient.createRoot(container);\n    root.render(React.createElement(NetworkFlow));\n    console.log('‚úì React Flow Network Topology Loaded');\n    console.log('‚úì Data source: NetworkData.getCustomerData()');\n    console.log('‚úì Selected Account:', appsmith.model?.selectedAccount || 'None');\n    console.log('‚úì Data rows available:', appsmith.model?.customerData?.length || 0);\n  } catch (error) {\n    console.error('‚ùå Error:', error);\n    document.getElementById('root').innerHTML = '<div style=\"padding: 20px; color: red;\">' + '<h3>Error Loading Network Topology</h3>' + '<p><strong>Error:</strong> ' + error.message + '</p>' + '<pre style=\"background: #f5f5f5; padding: 10px; overflow: auto;\">' + error.stack + '</pre></div>';\n  }\n});"
  },
  "theme": "{{appsmith.theme}}",
  "topRow": 8,
  "type": "CUSTOM_WIDGET",
  "uncompiledSrcDoc": {
    "css": "/* ============================================================================\n   SECTION 1: Container Reset & Layout\n   ============================================================================ */\n\n/* Function 1.1: Reset default styles and ensure full viewport */\n* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\n/* Function 1.2: Root container takes full widget space */\n#root {\n  width: 100%;\n  height: 100%;\n  min-height: 500px; /* Minimum height for usability */\n  position: relative;\n  overflow: hidden;\n}\n\n/* ============================================================================\n   SECTION 2: React Flow Specific Overrides\n   ============================================================================ */\n\n/* Function 2.1: Ensure React Flow container fills space */\n.react-flow {\n  width: 100% !important;\n  height: 100% !important;\n}\n\n/* Function 2.2: Style minimap for better visibility */\n.react-flow__minimap {\n  background-color: #f9fafb;\n  border: 1px solid #e5e7eb;\n}\n\n/* Function 2.3: Style controls panel */\n.react-flow__controls {\n  background-color: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n/* Function 2.4: Style control buttons */\n.react-flow__controls-button {\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.react-flow__controls-button:hover {\n  background-color: #f3f4f6;\n}\n\n/* ============================================================================\n   SECTION 3: Node & Edge Styling\n   ============================================================================ */\n\n/* Function 3.1: Node selection highlighting */\n.react-flow__node.selected {\n  box-shadow: 0 0 0 3px #3b82f6;\n}\n\n/* Function 3.2: Edge label styling */\n.react-flow__edge-text {\n  font-size: 11px;\n  font-weight: 600;\n  fill: #374151;\n}\n\n/* Function 3.3: Connection line preview */\n.react-flow__connection-path {\n  stroke: #6366f1;\n  stroke-width: 2;\n}\n\n/* ============================================================================\n   SECTION 4: Handle (Connection Point) Styling\n   ============================================================================ */\n\n/* Function 4.1: Base handle styling */\n.react-flow__handle {\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  border: 2px solid #3b82f6;\n  background-color: white;\n}\n\n/* Function 4.2: Handle hover state */\n.react-flow__handle:hover {\n  background-color: #3b82f6;\n  transform: scale(1.2);\n}\n\n/* Function 4.3: Handle connection state */\n.react-flow__handle-connecting {\n  background-color: #10b981;\n}\n\n/* Function 4.4: Valid connection target */\n.react-flow__handle-valid {\n  background-color: #10b981;\n}\n\n/* ============================================================================\n   SECTION 5: Background & Grid\n   ============================================================================ */\n\n/* Function 5.1: Background pattern styling */\n.react-flow__background {\n  background-color: #ffffff;\n}\n\n/* Function 5.2: Grid dot styling */\n.react-flow__background-pattern {\n  fill: #e5e7eb;\n}\n\n/* ============================================================================\n   SECTION 6: Loading & Error States\n   ============================================================================ */\n\n/* Function 6.1: Loading indicator */\n.topology-loading {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n  color: #6b7280;\n}\n\n/* Function 6.2: Error message styling */\n.topology-error {\n  padding: 20px;\n  color: #ef4444;\n  font-family: monospace;\n  background-color: #fef2f2;\n  border: 1px solid #fecaca;\n  border-radius: 6px;\n  margin: 20px;\n}",
    "html": "<!-- ============================================================================\n     REACT FLOW NETWORK TOPOLOGY - HTML COMPONENT\n     ============================================================================\n     \n     This is the HTML section of the Appsmith Custom Widget.\n     Copy this content into the \"HTML\" tab of your Custom Widget Builder.\n     \n     Components:\n     1. Root container for React rendering\n     2. Import map for ESM module resolution\n     3. React Flow CSS stylesheet\n     \n     ============================================================================\n-->\n\n<!-- FUNCTION 1: Root Container -->\n<div id=\"root\" style=\"width: 100%; height: 100%; min-height: 500px;\">\n  <p style=\"padding: 20px;\">Loading React Flow...</p>\n</div>\n\n<!-- FUNCTION 2: Import Map for ESM -->\n<script type=\"importmap\">\n{\n  \"imports\": {\n    \"react\": \"https://esm.sh/react@18.3.1\",\n    \"react-dom/client\": \"https://esm.sh/react-dom@18.3.1/client\",\n    \"reactflow\": \"https://esm.sh/reactflow@11.11.4\"\n  }\n}\n</script>\n\n<!-- FUNCTION 3: React Flow CSS -->\n<link \n  href=\"https://cdn.jsdelivr.net/npm/reactflow@11.11.4/dist/style.min.css\" \n  rel=\"stylesheet\"\n/>\n",
    "js": "/* ============================================================================\n * REACT FLOW NETWORK TOPOLOGY - DATA-DRIVEN VISUALIZATION\n * ============================================================================\n * \n * Project: Network Topology Migration from Mermaid to React Flow\n * Created: November 2025\n * \n * Purpose: Interactive network topology visualization with PostgreSQL integration\n * \n * Data Sources:\n * - appsmith.store.statclickaccount (selected customer)\n * - manipTable.tableData (customer configurations from PostgreSQL)\n * \n * Key Features:\n * - Dynamic node generation based on customer data\n * - Support for Gen1 (SBC) and IVP configurations\n * - Backbone trunk visualization\n * - Carrier connections with session agent details\n * - IVP service routing with inbound URIs\n * \n * ============================================================================\n */\n\n/* FUNCTION 1: Import Libraries and Initialize */\nappsmith.onReady(async () => {\n  console.log('=== ReactFlow Network Topology Init ===');\n  \n  try {\n    const React = await import('https://esm.sh/react');\n    const ReactDOMClient = await import('https://esm.sh/react-dom/client');\n    const ReactFlowModule = await import('https://esm.sh/reactflow');\n    \n    const { default: ReactFlow, Controls, Background, MiniMap, Handle, Position } = ReactFlowModule;\n\n    /* ========================================================================\n     * CUSTOM NODE COMPONENTS\n     * ========================================================================\n     */\n\n    /* FUNCTION 2: Custom SBC Node with Multiple Handles */\n    const SBCNode = ({ data }) => {\n      return React.createElement(\n        'div',\n        { style: data.style },\n        [\n          // Left handle for carrier input\n          React.createElement(Handle, {\n            key: 'target-left',\n            type: 'target',\n            position: Position.Left,\n            id: 'left',\n            style: { background: '#555' }\n          }),\n          // Right handle for customer/IVP output\n          React.createElement(Handle, {\n            key: 'source-right',\n            type: 'source',\n            position: Position.Right,\n            id: 'right',\n            style: { background: '#555' }\n          }),\n          // Sema handles (if needed)\n          React.createElement(Handle, {\n            key: 'source-bottom-dirty',\n            type: 'source',\n            position: Position.Bottom,\n            id: 'bottom-dirty',\n            style: { left: '40%', background: '#d32f2f' }\n          }),\n          React.createElement(Handle, {\n            key: 'source-bottom-clean',\n            type: 'source',\n            position: Position.Bottom,\n            id: 'bottom-clean',\n            style: { left: '60%', background: '#388e3c' }\n          }),\n          React.createElement(Handle, {\n            key: 'target-top-dirty',\n            type: 'target',\n            position: Position.Top,\n            id: 'top-dirty',\n            style: { left: '40%', background: '#d32f2f' }\n          }),\n          React.createElement(Handle, {\n            key: 'target-top-clean',\n            type: 'target',\n            position: Position.Top,\n            id: 'top-clean',\n            style: { left: '60%', background: '#388e3c' }\n          }),\n          // Label with line breaks\n          React.createElement('div', {\n            key: 'label',\n            style: { whiteSpace: 'pre-line', textAlign: 'center' },\n            dangerouslySetInnerHTML: { __html: data.label }\n          })\n        ]\n      );\n    };\n\n    /* FUNCTION 3: Custom Sema Node */\n    const SemaNode = ({ data }) => {\n      return React.createElement(\n        'div',\n        { style: data.style },\n        [\n          React.createElement(Handle, {\n            key: 'target-top-dirty',\n            type: 'target',\n            position: Position.Top,\n            id: 'top-dirty',\n            style: { left: '40%', background: '#d32f2f' }\n          }),\n          React.createElement(Handle, {\n            key: 'target-top-clean',\n            type: 'target',\n            position: Position.Top,\n            id: 'top-clean',\n            style: { left: '60%', background: '#388e3c' }\n          }),\n          React.createElement(Handle, {\n            key: 'source-bottom-dirty',\n            type: 'source',\n            position: Position.Bottom,\n            id: 'bottom-dirty',\n            style: { left: '40%', background: '#d32f2f' }\n          }),\n          React.createElement(Handle, {\n            key: 'source-bottom-clean',\n            type: 'source',\n            position: Position.Bottom,\n            id: 'bottom-clean',\n            style: { left: '60%', background: '#388e3c' }\n          }),\n          React.createElement('div', { key: 'label' }, data.label)\n        ]\n      );\n    };\n\n    /* FUNCTION 4: Custom IVP Cloud Node */\n    const IVPNode = ({ data }) => {\n      return React.createElement(\n        'div',\n        { style: data.style },\n        [\n          React.createElement(Handle, {\n            key: 'target-left',\n            type: 'target',\n            position: Position.Left,\n            id: 'left',\n            style: { background: '#555' }\n          }),\n          React.createElement(Handle, {\n            key: 'source-right',\n            type: 'source',\n            position: Position.Right,\n            id: 'right',\n            style: { background: '#555' }\n          }),\n          React.createElement('div', {\n            key: 'label',\n            style: { whiteSpace: 'pre-line', textAlign: 'center' }\n          }, '‚òÅÔ∏è ' + data.label)\n        ]\n      );\n    };\n\n\t\t/* FUNCTION 4.5: Custom Carrier Node with Top and Right Handles */\n    const CarrierNode = ({ data }) => {\n      return React.createElement(\n        'div',\n        { style: data.style },\n        [\n          // Top handle for IVP connections\n          React.createElement(Handle, {\n            key: 'source-top',\n            type: 'source',\n            position: Position.Top,\n            id: 'top',\n            style: { background: '#555' }\n          }),\n          // Right handle for SBC connections\n          React.createElement(Handle, {\n            key: 'source-right',\n            type: 'source',\n            position: Position.Right,\n            id: 'right',\n            style: { background: '#555' }\n          }),\n          React.createElement('div', {\n            key: 'label',\n            style: { textAlign: 'center' }\n          }, data.label)\n        ]\n      );\n    };\n\t\t\n /* FUNCTION 5: Node Types Registry */\n    const nodeTypes = {\n      sbcNode: SBCNode,\n      semaNode: SemaNode,\n      ivpNode: IVPNode,\n      carrierNode: CarrierNode\n    };\n\n    /* ========================================================================\n     * DATA PROCESSING UTILITIES\n     * ========================================================================\n     */\n\n    /* FUNCTION 6: Parse JSON Fields */\n    const parseJsonField = (field) => {\n      if (!field || field === 'null' || field === '[]') return [];\n      try {\n        return JSON.parse(field);\n      } catch {\n        return [];\n      }\n    };\n\n    /* FUNCTION 7: Split Concatenated Fields */\n    const splitConcatenatedField = (field) => {\n      if (!field || field === 'null' || field === 'N/A') return [];\n      return field.split(', ').map(s => s.trim());\n    };\n\n    /* FUNCTION 8: Build Session Agent Info */\n    const buildSessionAgentInfo = (data) => {\n      if (!data) return \"N/A\";\n      \n      const realm = data.source_realm || \"N/A\";\n      const sessionAgentsRaw = data.customer_realm_session_agents || \"N/A\";\n      const sessionAgents = sessionAgentsRaw === \"N/A\" ? \"N/A\" : \n        sessionAgentsRaw.split(',').map(s => s.trim()).join('\\n');\n      \n      const sipIpsRaw = data.sip_interface_ips || \"N/A\";\n      const sipIps = sipIpsRaw === \"N/A\" ? \"N/A\" : \n        sipIpsRaw.split(',').map(s => s.trim()).join('\\n');\n      \n      return `Realm: ${realm}\\nAgents:\\n${sessionAgents}\\nSIP IPs:\\n${sipIps}`;\n    };\n\n    /* ========================================================================\n     * MAIN NETWORK BUILDER FUNCTION\n     * ========================================================================\n     */\n\n    /* FUNCTION 9: Build Network Topology */\n    const buildNetworkTopology = () => {\n      // Get data from widget model (passed via JSObject)\n      // Data is already filtered to selected customer and is a real array\n      const selectedAccountNo = appsmith.model?.selectedAccount;\n      const tableData = appsmith.model?.customerData || [];\n      \n      console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n      console.log('üîç DIAGNOSTIC: buildNetworkTopology called');\n      console.log('üìä Selected account:', selectedAccountNo);\n      console.log('üìä Customer data rows:', tableData.length);\n      \n      if (tableData.length > 0) {\n        console.log('üìä Data sources:', tableData.map(r => r.data_source).join(', '));\n      }\n      console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n      \n      // Default state - no selection\n      if (!selectedAccountNo) {\n        return {\n          nodes: [{\n            id: 'msg',\n            type: 'default',\n            data: { label: 'Select a customer\\nto view network diagram' },\n            position: { x: 400, y: 200 },\n            style: {\n              background: '#f0f0f0',\n              border: '2px solid #999',\n              borderRadius: '8px',\n              padding: '20px',\n              fontSize: '14px',\n              textAlign: 'center'\n            }\n          }],\n          edges: []\n        };\n      }\n\n      // Find customer data\n      const customer = tableData.find(c => c.account_no === selectedAccountNo);\n      \n      // ============================================================================\n      // DIAGNOSTIC LOGGING - Customer Match\n      // ============================================================================\n      console.log('üîç DIAGNOSTIC: Customer lookup');\n      console.log('üìä Looking for account_no:', selectedAccountNo);\n      console.log('üìä Found customer?', customer ? 'YES ‚úÖ' : 'NO ‚ùå');\n      if (customer) {\n        console.log('üìä Customer name:', customer.customer);\n        console.log('üìä Customer account_no:', customer.account_no);\n      } else if (tableData.length > 0) {\n        // Try to find why match failed\n        const possibleMatches = tableData.filter(c => {\n          return String(c.account_no).includes(String(selectedAccountNo));\n        });\n        console.log('üìä Possible partial matches:', possibleMatches.length);\n        if (possibleMatches.length > 0) {\n          console.log('üìä Partial match examples:', possibleMatches.slice(0, 3).map(c => ({\n            account_no: c.account_no,\n            type: typeof c.account_no\n          })));\n        }\n      }\n      console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n      // ============================================================================\n      \n      if (!customer) {\n        return {\n          nodes: [{\n            id: 'msg',\n            type: 'default',\n            data: { label: `Account ${selectedAccountNo}\\n\\nNo Gen1 or IVP\\nconnections found` },\n            position: { x: 400, y: 200 },\n            style: {\n              background: '#fff3cd',\n              border: '2px solid #ffc107',\n              borderRadius: '8px',\n              padding: '20px',\n              fontSize: '14px',\n              textAlign: 'center'\n            }\n          }],\n          edges: []\n        };\n      }\n\n      // Extract customer metadata\n      const carriers = customer.carrier_connections || \"Carrier\";\n      const usesSema = customer.uses_sema_payments === true;\n      const hasBackbone = customer.gen1_ivp_backbone === true;\n      const customerName = customer.customer;\n      const accountNo = customer.account_no;\n\n      // Check for Gen1 configuration\n      const sourceRealm = customer.source_realm || \"\";\n      const hasGen1Realm = sourceRealm !== \"\" && sourceRealm !== null && sourceRealm !== \"null\";\n      \n      const hasLocalPolicyData = customer.local_policy_summary && \n        customer.local_policy_summary !== 'null' && \n        customer.local_policy_summary.trim() !== '';\n      \n      const hasGen1DataSource = customer.data_source && \n        (customer.data_source.startsWith('SYD1') || customer.data_source.startsWith('SYD2'));\n      \n      const showGen1Customer = hasGen1Realm || hasLocalPolicyData || hasGen1DataSource;\n\n      // Find SYD1/SYD2 specific data\n      const allCustomerRows = tableData.filter(c => c.account_no === selectedAccountNo);\n      const syd1Data = allCustomerRows.find(c => c.data_source && c.data_source.startsWith('SYD1'));\n      const syd2Data = allCustomerRows.find(c => c.data_source && c.data_source.startsWith('SYD2'));\n\n      // Build session agent info\n      const sessagen1 = buildSessionAgentInfo(syd1Data);\n      const sessagen2 = buildSessionAgentInfo(syd2Data);\n\n      // Get first IVP data row (avoid duplicates)\n      const firstIvpRow = allCustomerRows.find(row => {\n        const sipSvcs = parseJsonField(row.ivp_svcSIP);\n        const voiceGws = parseJsonField(row.ivp_svcVoiceGateway);\n        return sipSvcs.length > 0 || voiceGws.length > 0;\n      });\n\n      // Build IVP service table\n      const buildIvpServiceTable = (data) => {\n        if (!data) return { serviceTable: [], carriages: [] };\n        \n        const sipSvcs = parseJsonField(data.ivp_svcSIP);\n        const voiceGws = parseJsonField(data.ivp_svcVoiceGateway);\n        const carriages = parseJsonField(data.ivp_svccarriages);\n        \n        const regionNames = splitConcatenatedField(data[\"Region Name\"]);\n        const ivpNames = splitConcatenatedField(data.IVPName);\n        const routingDomains = splitConcatenatedField(data[\"Routing Domain\"]);\n        const inboundUris = splitConcatenatedField(data[\"Inbound server/uri\"]);\n        \n        const serviceTable = [];\n        \n        // Process SIP services\n        sipSvcs.forEach((svc, idx) => {\n          serviceTable.push({\n            type: 'SIP',\n            regionName: regionNames[idx] || 'AU1',\n            ivpName: ivpNames[idx] || 'N/A',\n            routingDomain: routingDomains[idx] || 'N/A',\n            inboundUri: inboundUris[idx] || 'N/A',\n            serviceData: svc,\n            index: idx\n          });\n        });\n        \n        // Process Voice Gateway services\n        voiceGws.forEach((gw, idx) => {\n          const serviceIdx = sipSvcs.length + idx;\n          serviceTable.push({\n            type: 'VoiceGateway',\n            regionName: regionNames[serviceIdx] || 'AU1',\n            ivpName: ivpNames[serviceIdx] || 'N/A',\n            routingDomain: routingDomains[serviceIdx] || 'N/A',\n            inboundUri: inboundUris[serviceIdx] || 'N/A',\n            serviceData: gw,\n            index: serviceIdx\n          });\n        });\n        \n        return { serviceTable, carriages };\n      };\n\n      const ivpData = buildIvpServiceTable(firstIvpRow);\n      const hasAnyIvpServices = ivpData.serviceTable.length > 0;\n      const hasIvpCarriages = ivpData.carriages.length > 0;\n\n      // Validate customer has connections\n      if (!hasGen1Realm && !hasAnyIvpServices) {\n        return {\n          nodes: [{\n            id: 'msg',\n            type: 'default',\n            data: { label: `${customerName}\\n(${accountNo})\\n\\nNo Gen1 or IVP\\nconnections found` },\n            position: { x: 400, y: 200 },\n            style: {\n              background: '#fff3cd',\n              border: '2px solid #ffc107',\n              borderRadius: '8px',\n              padding: '20px',\n              fontSize: '14px',\n              textAlign: 'center'\n            }\n          }],\n          edges: []\n        };\n      }\n\n      /* ====================================================================\n       * BUILD NODES AND EDGES\n       * ====================================================================\n       */\n\n      const nodes = [];\n      const edges = [];\n      \n      // ============================================================================\n      // LAYOUT CONFIGURATION - Clean Column-Based Positioning\n      // ============================================================================\n      const LAYOUT = {\n        COLUMN_1_CARRIERS: 100,       // Left edge - carriers\n        COLUMN_2_SBC: 500,             // SBC datacenter  \n        COLUMN_3_IVP: 950,             // IVP cloud\n        COLUMN_4_SERVICES: 1400,       // Customer services\n        VERTICAL_SPACING: 280,         // Space between stacked nodes\n        TOP_MARGIN: -100,              // Moved up by 180px (was 80, now -100)\n      };\n\n      // Determine layout parameters\n      const ivpRegions = new Set();\n      ivpData.serviceTable.forEach(svc => ivpRegions.add(svc.regionName));\n      const hasIvpAU1 = ivpRegions.has('AU1');\n      const hasIvpAU2 = ivpRegions.has('AU2');\n      \n\n\t\t\t\n/* FUNCTION 10: Add Carrier Node */\n      nodes.push({\n        id: 'carrier',\n        type: 'carrierNode',  // Changed from 'input' to 'carrierNode'\n        data: { label: carriers },\n        position: { \n          x: LAYOUT.COLUMN_1_CARRIERS, \n          y: hasIvpAU1 && hasIvpAU2 ? LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING : LAYOUT.TOP_MARGIN + 100\n        },\n        style: {\n          background: '#E3F2FD',\n          border: '2px solid #2196F3',\n          borderRadius: '8px',\n          padding: '15px 25px',\n          fontSize: '16px',\n          fontWeight: '600',\n          minWidth: '180px',\n          textAlign: 'center'\n        }\n      });\n\n/* FUNCTION 11: Add IVP Nodes and Services */\n      if (hasAnyIvpServices) {\n        // Add IVP AU1 - MOVED UP 100px\n        if (hasIvpAU1) {\n          nodes.push({\n            id: 'IVP-AU1',\n            type: 'ivpNode',\n            data: { label: 'IVP - AU1' },\n            position: { x: LAYOUT.COLUMN_3_IVP, y: LAYOUT.TOP_MARGIN - 100 }, // -100px\n            sourcePosition: Position.Right,\n            targetPosition: Position.Left,\n            style: {\n              background: 'linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%)',\n              border: '3px solid #4CAF50',\n              borderRadius: '12px',\n              padding: '18px 28px',\n              fontSize: '15px',\n              fontWeight: '600',\n              minWidth: '200px',\n              textAlign: 'center'\n            }\n          });\n        }\n\n        // Add IVP AU2 - MOVED UP 100px\n        if (hasIvpAU2) {\n          nodes.push({\n            id: 'IVP-AU2',\n            type: 'ivpNode',\n            data: { label: 'IVP - AU2' },\n            position: { x: LAYOUT.COLUMN_3_IVP, y: LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING - 200 }, // -100px\n            sourcePosition: Position.Right,\n            targetPosition: Position.Left,\n            style: {\n              background: 'linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%)',\n              border: '3px solid #4CAF50',\n              borderRadius: '12px',\n              padding: '18px 28px',\n              fontSize: '15px',\n              fontWeight: '600',\n              minWidth: '200px',\n              textAlign: 'center'\n            }\n          });\n        }\n\n        // Add IVP Service Boxes\n        const instanceCounters = {};\n        ivpRegions.forEach(region => {\n          instanceCounters[region] = 0;\n        });\n\n        let au1ServiceY = LAYOUT.TOP_MARGIN - 250; // -100px to match IVP-AU1\n        let au2ServiceY = LAYOUT.TOP_MARGIN + LAYOUT.VERTICAL_SPACING - 100; // -100px to match IVP-AU2\n        \n        ivpData.serviceTable.forEach(svc => {\n          // ... rest of the service creation code remains the same\n          const region = svc.regionName;\n          instanceCounters[region]++;\n          const seqNum = instanceCounters[region];\n          \n          const serviceNodeId = `service_inbound_${region}_${seqNum}`;\n          \n          // Calculate Y position based on region\n          let serviceY;\n          if (region === 'AU1') {\n            serviceY = au1ServiceY;\n            au1ServiceY += 120; // Stack multiple AU1 services vertically\n          } else {\n            serviceY = au2ServiceY;\n            au2ServiceY += 120; // Stack multiple AU2 services vertically\n          }\n          \n          // Create service label\n          const serviceLabel = svc.type === 'SIP' \n            ? `${svc.ivpName}\\n${svc.serviceData.profile?.name || 'SIP Service'}\\nInbound: ${svc.inboundUri}`\n            : `${svc.ivpName}\\nInbound: ${svc.inboundUri}`;\n          \n          // Add service node\n          nodes.push({\n            id: serviceNodeId,\n            type: 'output',\n            data: { label: serviceLabel },\n            position: { x: LAYOUT.COLUMN_4_SERVICES, y: serviceY },\n            targetPosition: Position.Left,\n            style: {\n              background: 'linear-gradient(135deg, #E1F5FE 0%, #B3E5FC 100%)',\n              border: '3px solid #0277BD',\n              borderRadius: '12px',\n              padding: '15px 20px',\n              fontSize: '13px',\n              whiteSpace: 'pre-line',\n              textAlign: 'center',\n              minWidth: '280px',\n              fontWeight: '500'\n            }\n          });\n          \n          // Add edge from IVP to service\n          edges.push({\n            id: `e-ivp-${region}-${seqNum}`,\n            source: `IVP-${region}`,\n            target: serviceNodeId,\n            label: svc.routingDomain,\n            type: 'smoothstep',  // Smooth routing for cleaner look\n            style: { stroke: '#7b1fa2', strokeWidth: 2.5 },\n            labelStyle: { fontSize: '11px', fill: '#666', fontWeight: '500' }\n          });\n        });\n\n// Add carrier to IVP connection if carriages exist\n        if (hasIvpCarriages) {\n          const carriageLabel = ivpData.carriages.map(c => c.name).join(', ');\n          const targetIvp = hasIvpAU1 ? 'IVP-AU1' : 'IVP-AU2';\n          \n          edges.push({\n            id: 'e-carrier-ivp',\n            source: 'carrier',\n            sourceHandle: 'top',  // ADDED: Use top handle\n            target: targetIvp,\n            label: carriageLabel,\n            type: 'smoothstep',\n            animated: true,\n            style: { stroke: '#1976d2', strokeWidth: 2.5 },\n            labelStyle: { fontSize: '11px', fill: '#666', fontWeight: '500' }\n          });\n        }\n      }\n\n/* FUNCTION 12: Add Gen1 SBC Nodes */\n      if (showGen1Customer) {\n        // Add SYD1 - MOVED DOWN 200px\n        nodes.push({\n          id: 'SYD1',\n          type: 'sbcNode',\n          data: {\n            label: `SYD1 Data-Centre SBC\\n${sessagen1}`,\n            style: {\n              background: 'linear-gradient(135deg, #BBDEFB 0%, #E3F2FD 100%)',\n              border: '3px solid #1565C0',\n              borderRadius: '12px',\n              padding: '20px',\n              fontSize: '13px',\n              width: '320px',\n              fontWeight: '500'\n            }\n          },\n          position: { x: LAYOUT.COLUMN_2_SBC, y: LAYOUT.TOP_MARGIN + 200 }, // +200px\n          sourcePosition: Position.Right,\n          targetPosition: Position.Left\n        });\n\n        // Add Sema if needed - MOVED DOWN 200px\n        if (usesSema) {\n          nodes.push({\n            id: 'Sema',\n            type: 'semaNode',\n            data: {\n              label: 'Sema',\n              style: {\n                background: '#FFE0B2',\n                border: '3px solid #F57C00',\n                borderRadius: '10px',\n                padding: '18px 30px',\n                fontSize: '16px',\n                fontWeight: 'bold',\n                textAlign: 'center',\n                minWidth: '120px'\n              }\n            },\n            position: { x: LAYOUT.COLUMN_2_SBC + 100, y: LAYOUT.TOP_MARGIN + (LAYOUT.VERTICAL_SPACING * 0.8) + 200 } // +200px\n          });\n\n          // Sema connections (unchanged)\n          edges.push(\n            {\n              id: 'e-syd1-sema-dirty',\n              source: 'SYD1',\n              sourceHandle: 'bottom-dirty',\n              target: 'Sema',\n              targetHandle: 'top-dirty',\n              label: 'dirty',\n              type: 'straight',\n              style: { stroke: '#d32f2f', strokeWidth: 2 },\n              labelStyle: { fill: '#d32f2f', fontWeight: 600, fontSize: '10px' }\n            },\n            {\n              id: 'e-syd1-sema-clean',\n              source: 'SYD1',\n              sourceHandle: 'bottom-clean',\n              target: 'Sema',\n              targetHandle: 'top-clean',\n              label: 'clean',\n              type: 'straight',\n              style: { stroke: '#388e3c', strokeWidth: 2 },\n              labelStyle: { fill: '#388e3c', fontWeight: 600, fontSize: '10px' }\n            }\n          );\n        }\n\n        // Add SYD2 - MOVED DOWN 200px\n        nodes.push({\n          id: 'SYD2',\n          type: 'sbcNode',\n          data: {\n            label: `SYD2 Data-Centre SBC\\n${sessagen2}`,\n            style: {\n              background: 'linear-gradient(135deg, #BBDEFB 0%, #E3F2FD 100%)',\n              border: '3px solid #1565C0',\n              borderRadius: '12px',\n              padding: '20px',\n              fontSize: '13px',\n              width: '320px',\n              fontWeight: '500'\n            }\n          },\n          position: { x: LAYOUT.COLUMN_2_SBC, y: LAYOUT.TOP_MARGIN + (LAYOUT.VERTICAL_SPACING * 1.5) + 200 }, // +200px\n          sourcePosition: Position.Right,\n          targetPosition: Position.Left\n        });\n\n        // Sema to SYD2 connections\n        if (usesSema) {\n          edges.push(\n            {\n              id: 'e-sema-syd2-dirty',\n              source: 'Sema',\n              sourceHandle: 'bottom-dirty',\n              target: 'SYD2',\n              targetHandle: 'top-dirty',\n              label: 'dirty',\n              type: 'straight',\n              style: { stroke: '#d32f2f', strokeWidth: 2 },\n              labelStyle: { fill: '#d32f2f', fontWeight: 600, fontSize: '10px' }\n            },\n            {\n              id: 'e-sema-syd2-clean',\n              source: 'Sema',\n              sourceHandle: 'bottom-clean',\n              target: 'SYD2',\n              targetHandle: 'top-clean',\n              label: 'clean',\n              type: 'straight',\n              style: { stroke: '#388e3c', strokeWidth: 2 },\n              labelStyle: { fill: '#388e3c', fontWeight: 600, fontSize: '10px' }\n            }\n          );\n        }\n\n        // Carrier to SBC connections\n// Carrier to SBC connections\n        edges.push(\n          {\n            id: 'e-carrier-syd1',\n            source: 'carrier',\n            sourceHandle: 'right',  // ADDED: Use right handle\n            target: 'SYD1',\n            targetHandle: 'left',\n            type: 'smoothstep',\n            animated: true,\n            style: { stroke: '#1976d2', strokeWidth: 2.5 }\n          },\n          {\n            id: 'e-carrier-syd2',\n            source: 'carrier',\n            sourceHandle: 'right',  // ADDED: Use right handle\n            target: 'SYD2',\n            targetHandle: 'left',\n            type: 'smoothstep',\n            style: { stroke: '#1976d2', strokeWidth: 1.5, strokeDasharray: '5,5' }\n          }\n        );\n\n// Gen1 Customer Node - show when customer has Gen1 realm configuration\n        if (hasGen1Realm) {\n          const gen1Y = hasIvpAU1 && hasIvpAU2 \n            ? LAYOUT.TOP_MARGIN + (LAYOUT.VERTICAL_SPACING * 1.2) + 400  // ADDED +400px\n            : LAYOUT.TOP_MARGIN + (LAYOUT.VERTICAL_SPACING * 0.5) + 400; // ADDED +400px\n            \n          nodes.push({\n            id: 'Gen1Cust',\n            type: 'output',\n            data: { label: `${customerName} Services\\n(${accountNo})\\nRealm: ${sourceRealm}` },\n            position: { x: LAYOUT.COLUMN_4_SERVICES, y: gen1Y },\n            targetPosition: Position.Left,\n            style: {\n              background: 'linear-gradient(135deg, #FFF9C4 0%, #FFF59D 100%)',\n              border: '3px solid #F9A825',\n              borderRadius: '12px',\n              padding: '15px 20px',\n              fontSize: '13px',\n              whiteSpace: 'pre-line',\n              textAlign: 'center',\n              minWidth: '250px',\n              fontWeight: '500'\n            }\n          });\n\n          // SBC to Gen1 Customer connections\n          const syd1Realm = syd1Data?.source_realm;\n          const syd2Realm = syd2Data?.source_realm;\n          \n          if (syd1Realm && syd1Realm !== 'N/A') {\n            edges.push({\n              id: 'e-syd1-gen1',\n              source: 'SYD1',\n              sourceHandle: 'right',\n              target: 'Gen1Cust',\n              label: syd1Realm,\n              type: 'smoothstep',\n              style: { stroke: '#388e3c', strokeWidth: 2.5 },\n              labelStyle: { fontSize: '11px', fill: '#666', fontWeight: '500' }\n            });\n          }\n          \n          if (syd2Realm && syd2Realm !== 'N/A' && syd2Realm !== null) {\n            edges.push({\n              id: 'e-syd2-gen1',\n              source: 'SYD2',\n              sourceHandle: 'right',\n              target: 'Gen1Cust',\n              label: syd2Realm,\n              type: 'smoothstep',\n              style: { stroke: '#388e3c', strokeWidth: 1.5, strokeDasharray: '5,5' },\n              labelStyle: { fontSize: '11px', fill: '#666' }\n            });\n          }\n        }\n\n        // BACKBONE TRUNK: Direct SBC to IVP connection (thick green line)\n        if (hasBackbone && hasAnyIvpServices) {\n          const targetIvp = hasIvpAU1 ? 'IVP-AU1' : 'IVP-AU2';\n          \n          edges.push({\n            id: 'e-backbone-trunk',\n            source: 'SYD1',\n            sourceHandle: 'right',\n            target: targetIvp,\n            targetHandle: 'left',\n            label: 'Backbone',\n            type: 'smoothstep',  // Use smooth routing to avoid crossing Sema\n            animated: true,\n            style: { \n              stroke: '#4CAF50', \n              strokeWidth: 5 \n            },\n            labelStyle: { \n              fontSize: '13px', \n              fill: '#2E7D32',\n              fontWeight: 'bold',\n              background: 'white',\n              padding: '2px 6px',\n              borderRadius: '4px'\n            }\n          });\n        }\n      }\n\n      return { nodes, edges };\n    };\n\n    /* ========================================================================\n     * REACT FLOW COMPONENT\n     * ========================================================================\n     */\n\n    /* FUNCTION 13: Network Flow Component */\n    const NetworkFlow = () => {\n      const [nodes, setNodes] = React.useState([]);\n      const [edges, setEdges] = React.useState([]);\n      const [lastAccount, setLastAccount] = React.useState(null);\n\n      // Poll for changes to customer selection\n      React.useEffect(() => {\n        // Initial load\n        const updateTopology = () => {\n          const currentAccount = appsmith.model?.selectedAccount;\n          \n          // Only rebuild if account changed\n          if (currentAccount !== lastAccount) {\n            console.log('üîÑ Customer selection changed:', lastAccount, '‚Üí', currentAccount);\n            setLastAccount(currentAccount);\n            \n            const newTopology = buildNetworkTopology();\n            setNodes(newTopology.nodes);\n            setEdges(newTopology.edges);\n          }\n        };\n        \n        // Initial render\n        updateTopology();\n        \n        // Poll every 500ms for changes\n        const interval = setInterval(updateTopology, 500);\n        \n        return () => clearInterval(interval);\n      }, [lastAccount]);\n\n      return React.createElement(\n        'div',\n        { style: { width: '100%', height: '700px' } },\n        React.createElement(ReactFlow, {\n          nodes,\n          edges,\n          nodeTypes,\n          fitView: true,\n          minZoom: 0.3,\n          maxZoom: 1.5,\n          defaultViewport: { x: 0, y: 0, zoom: 0.7 }\n        }, [\n          React.createElement(Controls, { key: 'controls' }),\n          React.createElement(MiniMap, { \n            key: 'minimap',\n            nodeColor: (node) => {\n              if (node.type === 'group') return 'rgba(200, 200, 200, 0.3)';\n              if (node.style?.background) return node.style.background;\n              return '#ddd';\n            },\n            maskColor: 'rgba(0, 0, 0, 0.1)'\n          }),\n          React.createElement(Background, { \n            key: 'background',\n            variant: 'dots',\n            gap: 16,\n            size: 1,\n            color: '#ddd'\n          })\n        ])\n      );\n    };\n\n    /* FUNCTION 14: Render to DOM */\n    const container = document.getElementById('root');\n    const root = ReactDOMClient.createRoot(container);\n    root.render(React.createElement(NetworkFlow));\n    \n    console.log('‚úì React Flow Network Topology Loaded');\n    console.log('‚úì Data source: NetworkData.getCustomerData()');\n    console.log('‚úì Selected Account:', appsmith.model?.selectedAccount || 'None');\n    console.log('‚úì Data rows available:', appsmith.model?.customerData?.length || 0);\n    \n  } catch (error) {\n    console.error('‚ùå Error:', error);\n    document.getElementById('root').innerHTML = \n      '<div style=\"padding: 20px; color: red;\">' +\n      '<h3>Error Loading Network Topology</h3>' +\n      '<p><strong>Error:</strong> ' + error.message + '</p>' +\n      '<pre style=\"background: #f5f5f5; padding: 10px; overflow: auto;\">' + \n      error.stack + \n      '</pre></div>';\n  }\n});"
  },
  "version": 1,
  "widgetId": "w0yrj9tm0d",
  "widgetName": "ReactFlow"
}